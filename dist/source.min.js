!function(a,b,c,d){"use strict";function e(a,d){if(a)throw console.error("Unable to fetch heatmap data"),a;y=d,s=y.length,t=y[0].length,u=y[0][0].length,v=Math.floor(s/2),w=Math.floor(t/2),x=Math.floor(u/2),N={x:v,y:w,z:x},A=b.max([s,u]),B=t+M+t+M+s+M+O+P,E=b.scale.linear().range([0,1,2,3,4,5,6,7,8]).domain([0,t,t+M,2*t+M,2*t+2*M,2*t+2*M+s,2*t+3*M+s,2*t+3*M+s+O,B]),F=b.scale.linear().domain([0,s]).range([0,s]),G=b.scale.linear().domain([0,t]).range([t,0]),H=b.scale.linear().domain([0,t]).range([0,t]),I=b.scale.linear().domain([0,u]).range([0,u]),J=b.scale.linear().domain([0,255]).range([0,A]),q=b.select("#canvas_wrapper").append("canvas").attr({width:B,height:A,"class":"slicer"}),r=q.node().getContext("2d"),q.call(n).call(h,y,0,0,t,A,x,2).call(h,y,t+M,0,t,A,v,0).call(h,y,2*t+2*M,0,s,A,w,1).call(g,2*t+3*M+s,0).call(o).call(l).on("mousemove",j).on("mouseout",k),c("#slicer_loading").fadeOut(1e3,function(){c("canvas");c("canvas").toggle("slide")})}function f(a){a||(a=Math.floor(E.invert(7))),r.clearRect(a,0,P,A)}function g(a,b){var c=r.createLinearGradient(b,0,b,A);c.addColorStop(0,"black"),c.addColorStop(1,"white"),r.fillStyle=c,r.fillRect(b,0,O,A)}function h(a,b,c,d,e,f,g,h){g=Math.floor(g);for(var i=[function(a,c){return b[g][t-1-c][a]},function(a,c){return b[c][g][a]},function(a,c){return b[a][t-1-c][g]}],j=[[u,t],[u,s],[u,t]],k=i[h],l=j[h][0],n=j[h][1],o=r.createImageData(e,f),p=0,q=-1;l>p;++p)for(var v=0;n>v;++v)o.data[++q]=k(p,v),o.data[++q]=k(p,v),o.data[++q]=k(p,v),o.data[++q]=255*m(k(p,v)%255);r.putImageData(o,c,d)}function i(){}function j(){var a=this,c=b.mouse(a)[0],d=b.mouse(a)[1];switch(i(!1),C&&(N.x=Math.floor(N.x),N.y=Math.floor(N.y),N.z=Math.floor(N.z),clearInterval(D),clearTimeout(C),C=null),Math.ceil(E(c))){case 1:N.x=s-Math.floor(F.invert(d)),N.y=Math.floor(G.invert(c)),h(r,y,t+M,0,t,A,N.x,0),h(r,y,2*t+2*M+M,0,s,A,N.y,1);break;case 3:N.z=Math.floor(I.invert(d)),N.y=t-Math.floor(H.invert(c-t-M)),h(r,y,0,0,t,A,N.z,2),h(r,y,2*t+2*M+M,0,s,A,N.y,1);break;case 5:N.z=Math.floor(I.invert(d)),N.x=Math.floor(F.invert(c-2*t-2*M)),h(r,y,0,0,t,A,N.z,2),h(r,y,t+M,0,t,A,N.x,0)}if(Math.floor(N.x)!=N.x)throw new Error("hey you should be an int");p()}function k(){if(z===d)throw new Error("Cannot animate MRI panes unless a max refresh rate is defined");var a=this,c=1e3,e=(b.mouse(a)[0],b.mouse(a)[1],Math.ceil(c/z)),g={x:(v-N.x)/e,y:(w-N.y)/e,z:(x-N.z)/e};C=setTimeout(function(){f(),D=setInterval(function(){N.x+=g.x,N.y+=g.y,N.z+=g.z,h(r,y,t+M,0,t,A,N.x,0),h(r,y,2*t+2*M+M,0,s,A,N.y,1),h(r,y,0,0,t,A,N.z,2),--e,e||(clearInterval(D),N.x=Math.floor(N.x),N.y=Math.floor(N.y),N.z=Math.floor(N.z),i(!0))},z)},500)}function l(){if(!K||!L)throw new Error("Timer flags must be set to compute max animation speed");z=Math.ceil(1.5*(L-K)),z>33&&(z=33),L=K=0}function m(a){return+a===a?0===a?a:a>0?1:-1:0/0}function n(){return K=(new Date).getTime()}function o(){return L=(new Date).getTime()}function p(){var a,b,c=Math.floor(E.invert(7)),e=P-2,g=Math.PI/2,h=3*Math.PI/2;if(y[N.x]!==d&&y[N.x][N.y]!==d&&y[N.x][N.y][N.z]!==d)a=y[N.x][N.y][N.z],b=Math.floor(J(a));else{if(y[N.x]===d)throw new Error("Heatmap has no X coord of "+N.x);if(y[N.x][N.y]===d)throw new Error("Heatmap has no Y coord of "+N.y);if(y[N.x][N.y][N.z]===d)throw new Error("Heatmap has no Z coord of "+N.z)}if(0>a||a>255)throw new Error("Invalid guageValue detected: "+a);f(c),a>0&&255>a&&(r.beginPath(),r.arc(c+1,b,e,g,h,!0),r.stroke(),r.beginPath(),r.moveTo(c+1,b),r.lineTo(c,b),r.stroke())}if(!(a&&b&&c&&c.effects))throw new Error("MRI slicer dependencies not met");if(!document.createElement("canvas").getContext)throw new Error("Your browser is unsupported");var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=(b.scale.linear().domain([0,255]).range(["black","white"]),5),N={x:null,y:null,z:null},O=20,P=5;b.json("sample_data/TT1.json",e)}(window,d3,jQuery);