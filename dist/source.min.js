!function(a,b,c,d){"use strict";function e(a,d){if(a)throw console.error("Unable to fetch heatmap data"),a;y=d,s=y.length,t=y[0].length,u=y[0][0].length,v=Math.floor(s/2),w=Math.floor(t/2),x=Math.floor(u/2),P={x:v,y:w,z:x},C=b.max([s,u]),D=t+O+t+O+s+O+Q+R,G=b.scale.linear().range([0,1,2,3,4,5,6,7,8]).domain([0,t,t+O,2*t+O,2*t+2*O,2*t+2*O+s,2*t+3*O+s,2*t+3*O+s+Q,D]),H=b.scale.linear().domain([0,s]).range([0,s]),I=b.scale.linear().domain([0,t]).range([t,0]),J=b.scale.linear().domain([0,t]).range([0,t]),K=b.scale.linear().domain([0,u]).range([0,u]),L=b.scale.linear().domain([0,255]).range([0,C]),q=b.select("#canvas_wrapper").append("canvas").attr({width:D,height:C,"class":"slicer"}),r=q.node().getContext("2d"),q.call(n).call(h,y,0,0,t,C,x,2).call(h,y,t+O,0,t,C,v,0).call(h,y,2*t+2*O,0,s,C,w,1).call(g,2*t+3*O+s,0).call(o).call(l).on("mousemove",j).on("mouseout",k),c("#slicer_loading").fadeOut(1e3,function(){c("canvas");c("canvas").toggle("slide")}),i(!0)}function f(a){a||(a=Math.floor(G.invert(7))),r.clearRect(a,0,R,C)}function g(a,b){var c=r.createLinearGradient(b,0,b,C);c.addColorStop(0,"black"),c.addColorStop(1,"white"),r.fillStyle=c,r.fillRect(b,0,Q,C)}function h(a,b,c,d,e,f,g,h){g=Math.floor(g);for(var i=[function(a,c){return b[g][t-1-c][a]},function(a,c){return b[c][g][a]},function(a,c){return b[a][t-1-c][g]}],j=[[u,t],[u,s],[u,t]],k=i[h],l=j[h][0],n=j[h][1],o=r.createImageData(e,f),p=0,q=-1;l>p;++p)for(var v=0;n>v;++v)o.data[++q]=k(p,v),o.data[++q]=k(p,v),o.data[++q]=k(p,v),o.data[++q]=255*m(k(p,v)%255);r.putImageData(o,c,d)}function i(a){return a?void(z=setInterval(function(){if(!A){var a,c,d=b.min([s,t,u]),e=0;d===s?(a=v,c="x"):d===t?(a=w,c="y"):(a=x,c="z"),A=setInterval(function(){a/2>e?--P[c]:1.5*a>e?++P[c]:2*a>e?--P[c]:(clearInterval(A),A=null),h(r,y,t+O,0,t,C,P[c],0),h(r,y,2*t+2*O+O,0,s,C,P[c],1),h(r,y,0,0,t,C,P[c],2),++e},B)}},1e4)):(clearInterval(z),z=null,clearInterval(A),void(A=null))}function j(){var a=this,c=b.mouse(a)[0],d=b.mouse(a)[1];switch(i(!1),E&&(P.x=Math.floor(P.x),P.y=Math.floor(P.y),P.z=Math.floor(P.z),clearInterval(F),clearTimeout(E),E=null),Math.ceil(G(c))){case 1:P.x=s-Math.floor(H.invert(d)),P.y=Math.floor(I.invert(c)),h(r,y,t+O,0,t,C,P.x,0),h(r,y,2*t+2*O+O,0,s,C,P.y,1);break;case 3:P.z=Math.floor(K.invert(d)),P.y=t-Math.floor(J.invert(c-t-O)),h(r,y,0,0,t,C,P.z,2),h(r,y,2*t+2*O+O,0,s,C,P.y,1);break;case 5:P.z=Math.floor(K.invert(d)),P.x=Math.floor(H.invert(c-2*t-2*O)),h(r,y,0,0,t,C,P.z,2),h(r,y,t+O,0,t,C,P.x,0)}if(Math.floor(P.x)!=P.x)throw new Error("hey you should be an int");p()}function k(){if(B===d)throw new Error("Cannot animate MRI panes unless a max refresh rate is defined");var a=this,c=1e3,e=(b.mouse(a)[0],b.mouse(a)[1],Math.ceil(c/B)),g={x:(v-P.x)/e,y:(w-P.y)/e,z:(x-P.z)/e};E=setTimeout(function(){f(),F=setInterval(function(){P.x+=g.x,P.y+=g.y,P.z+=g.z,h(r,y,t+O,0,t,C,P.x,0),h(r,y,2*t+2*O+O,0,s,C,P.y,1),h(r,y,0,0,t,C,P.z,2),--e,e||(clearInterval(F),P.x=Math.floor(P.x),P.y=Math.floor(P.y),P.z=Math.floor(P.z),i(!0))},B)},500)}function l(){if(!M||!N)throw new Error("Timer flags must be set to compute max animation speed");B=Math.ceil(1.5*(N-M)),B>33&&(B=33),N=M=0}function m(a){return+a===a?0===a?a:a>0?1:-1:0/0}function n(){return M=(new Date).getTime()}function o(){return N=(new Date).getTime()}function p(){var a,b,c=Math.floor(G.invert(7)),e=R-2,g=Math.PI/2,h=3*Math.PI/2;if(y[P.x]!==d&&y[P.x][P.y]!==d&&y[P.x][P.y][P.z]!==d)a=y[P.x][P.y][P.z],b=Math.floor(L(a));else{if(y[P.x]===d)throw new Error("Heatmap has no X coord of "+P.x);if(y[P.x][P.y]===d)throw new Error("Heatmap has no Y coord of "+P.y);if(y[P.x][P.y][P.z]===d)throw new Error("Heatmap has no Z coord of "+P.z)}if(0>a||a>255)throw new Error("Invalid guageValue detected: "+a);f(c),a>0&&255>a&&(r.beginPath(),r.arc(c+1,b,e,g,h,!0),r.stroke(),r.beginPath(),r.moveTo(c+1,b),r.lineTo(c,b),r.stroke())}if(!(a&&b&&c&&c.effects))throw new Error("MRI slicer dependencies not met");if(!document.createElement("canvas").getContext)throw new Error("Your browser is unsupported");var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=(b.scale.linear().domain([0,255]).range(["black","white"]),5),P={x:null,y:null,z:null},Q=20,R=5;b.json("sample_data/TT1.json",e)}(window,d3,jQuery);
//# sourceMappingURL=source.min.js.map