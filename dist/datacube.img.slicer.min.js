!function(a,b){"use strict";function c(c){if(!c||!c.data)throw new Error("Attempted to build 3d slicer with insufficient config data!");if(c.mouseout===b||"slide-to-center"===c.mouseout)F=1;else{if("string"==typeof c.mouseout)throw new Error("Invalid mouseout requested");F=0}H=c.mouseoutAnimationDur||1e3,G=c.mouseoutDelay||500,c.idleAnimation&&(B=!0,A=c.idleAnimationPercentage||.25),S=c.target||"body",c.cb&&(r=c.cb),a.json(c.data,d)}function d(b,c){if(b)throw console.error("Unable to fetch heatmap data"),b;if(!document.createElement("canvas").getContext)throw new Error("Your browser is unsupported");z=c,t=z.length,u=z[0].length,v=z[0][0].length,w=Math.floor(t/2),x=Math.floor(u/2),y=Math.floor(v/2),W={x:w,y:x,z:y},I=a.max([t,v]),J=u+V+u+V+t+V+X+Y,M=a.scale.linear().range([0,1,2,3,4,5,6,7,8]).domain([0,u,u+V,2*u+V,2*u+2*V,2*u+2*V+t,2*u+3*V+t,2*u+3*V+t+X,J]),N=a.scale.linear().domain([0,t]).range([0,t]),O=a.scale.linear().domain([0,u]).range([u,0]),P=a.scale.linear().domain([0,u]).range([0,u]),Q=a.scale.linear().domain([0,v]).range([0,v]),R=a.scale.linear().domain([0,255]).range([0,I]),q=a.select(S).append("canvas").attr({width:J,height:I,"class":"datacube-slicer"}),s=q.node().getContext("2d"),q.call(n).call(g,z,0,0,u,I,y,2).call(g,z,u+V,0,u,I,w,0).call(g,z,2*u+2*V,0,t,I,x,1).call(f,2*u+3*V+t,0).call(o).call(l).on("mousemove",i).on("mouseout",j),h(B),r&&r()}function e(a){a||(a=Math.floor(M.invert(7))),s.clearRect(a,0,Y,I)}function f(a,b){var c=s.createLinearGradient(b,0,b,I);c.addColorStop(0,"black"),c.addColorStop(1,"white"),s.fillStyle=c,s.fillRect(b,0,X,I)}function g(a,b,c,d,e,f,g,h){g=Math.floor(g);for(var i=[function(a,c){return b[g][u-1-c][a]},function(a,c){return b[c][g][a]},function(a,c){return b[a][u-1-c][g]}],j=[[v,u],[v,t],[v,u]],k=i[h],l=j[h][0],n=j[h][1],o=s.createImageData(e,f),p=0,q=-1;l>p;++p)for(var r=0;n>r;++r)o.data[++q]=k(p,r),o.data[++q]=k(p,r),o.data[++q]=k(p,r),o.data[++q]=255*m(k(p,r)%255);s.putImageData(o,c,d)}function h(b){if(!b)return C&&clearInterval(C),C=null,D&&clearInterval(D),void(D=null);var c,d,e=a.min([t,u,v]);e===t?(c=w,d="x"):e===u?(c=x,d="y"):(c=y,d="z"),C=setInterval(function(){if(!D){var a=0;D=setInterval(function(){c/2>a?--W[d]:1.5*c>a?++W[d]:2*c>a?--W[d]:(clearInterval(D),D=null),g(s,z,u+V,0,u,I,W[d],0),g(s,z,2*u+2*V+V,0,t,I,W[d],1),g(s,z,0,0,u,I,W[d],2),++a},E)}},Math.floor(E*c*2*(1/A)))}function i(){var b=this,c=a.mouse(b)[0],d=a.mouse(b)[1];switch(h(!1),K&&(W.x=Math.floor(W.x),W.y=Math.floor(W.y),W.z=Math.floor(W.z),clearInterval(L),clearTimeout(K),K=null),Math.ceil(M(c))){case 1:W.x=t-Math.floor(N.invert(d)),W.y=Math.floor(O.invert(c)),g(s,z,u+V,0,u,I,W.x,0),g(s,z,2*u+2*V+V,0,t,I,W.y,1);break;case 3:W.z=Math.floor(Q.invert(d)),W.y=u-Math.floor(P.invert(c-u-V)),g(s,z,0,0,u,I,W.z,2),g(s,z,2*u+2*V+V,0,t,I,W.y,1);break;case 5:W.z=Math.floor(Q.invert(d)),W.x=Math.floor(N.invert(c-2*u-2*V)),g(s,z,0,0,u,I,W.z,2),g(s,z,u+V,0,u,I,W.x,0)}if(Math.floor(W.x)!=W.x)throw new Error("hey you should be an int");p()}function j(){if(1===F){if(E===b)throw new Error("Cannot animate MRI panes unless a max refresh rate is defined");var c=this,d=H,f=(a.mouse(c)[0],a.mouse(c)[1],Math.ceil(d/E)),i={x:(w-W.x)/f,y:(x-W.y)/f,z:(y-W.z)/f};K=setTimeout(function(){e(),L=setInterval(function(){W.x+=i.x,W.y+=i.y,W.z+=i.z,g(s,z,u+V,0,u,I,W.x,0),g(s,z,2*u+2*V+V,0,t,I,W.y,1),g(s,z,0,0,u,I,W.z,2),--f,f||(clearInterval(L),W.x=Math.floor(W.x),W.y=Math.floor(W.y),W.z=Math.floor(W.z))},E)},G)}else k();h(B)}function k(){W.x=w,W.y=x,W.z=y,g(s,z,u+V,0,u,I,W.x,0),g(s,z,2*u+2*V+V,0,t,I,W.y,1),g(s,z,0,0,u,I,W.z,2)}function l(){if(!T||!U)throw new Error("Timer flags must be set to compute max animation speed");E=Math.ceil(1.5*(U-T)),E>33&&(E=33),U=T=0}function m(a){return+a===a?0===a?a:a>0?1:-1:0/0}function n(){return T=(new Date).getTime()}function o(){return U=(new Date).getTime()}function p(){var a,c,d=Math.floor(M.invert(7)),f=Y-2,g=Math.PI/2,h=3*Math.PI/2;if(z[W.x]!==b&&z[W.x][W.y]!==b&&z[W.x][W.y][W.z]!==b)a=z[W.x][W.y][W.z],c=Math.floor(R(a));else{if(z[W.x]===b)throw new Error("Heatmap has no X coord of "+W.x);if(z[W.x][W.y]===b)throw new Error("Heatmap has no Y coord of "+W.y);if(z[W.x][W.y][W.z]===b)throw new Error("Heatmap has no Z coord of "+W.z)}if(0>a||a>255)throw new Error("Invalid guageValue detected: "+a);e(d),a>0&&255>a&&(s.beginPath(),s.arc(d+1,c,f,g,h,!0),s.stroke(),s.beginPath(),s.moveTo(d+1,c),s.lineTo(d,c),s.stroke())}if("undefined"!=typeof module&&"undefined"!=typeof require)a=require("d3");else if(!a)throw new Error("MRI slicer dependencies not met");var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V=(a.scale.linear().domain([0,255]).range(["black","white"]),5),W={x:null,y:null,z:null},X=20,Y=5;if("undefined"!=typeof module&&"undefined"!=typeof require)module.exports=c;else{if(window.datacubeSlicer)throw new Error("datacubeSlicerdy exists on the window.  Overwriting not permitted.");window.datacubeSlicer=c}}(d3);
//# sourceMappingURL=datacube.img.slicer.min.js.map