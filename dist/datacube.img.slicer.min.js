!function(a){"use strict";function b(a){var b;if(!a||!a.data)throw new Error("Attempted to build 3d slicer with insufficient config data!");q=["black","white"],L=!1,M=0,K=!1,z=5,A=0,N="#000000",B=5,P=.25,Z=2,X=1e3,W=500,V=1,ib="body",mb=[0,2,4];for(var d in a)if(a.hasOwnProperty(d))switch(b=a[d],d){case"canvasAttrs":p=b;break;case"cb":C=b;break;case"data":break;case"debug":w=b;break;case"drawColor":q[0]=b;break;case"gap":z=b;break;case"gauge":b&&(A=a.gaugeWidth||20);break;case"gaugeWidth":A=b;break;case"gaugeDialColor":N=b;break;case"idleAnimation":Q=!!b;break;case"idleAnimationPercentage":P=b;break;case"invertTransparency":T=!0;break;case"mouseout":if("slide-to-center"===b)break;V=0;break;case"mouseoutAnimationDur":X=b;break;case"mouseoutDelay":W=b;break;case"target":ib=b;break;case"transparentExtremes":jb=!!b;break;default:throw new Error("Invalid configuration parameter passed ("+d+")")}s=r.getRgb(q[0]),t=s[0],u=s[1],v=s[2],x.json(a.data,c)}function c(a,b){if(a)throw console.error("Unable to fetch heatmap data"),a;if(!document.createElement("canvas").getContext)throw new Error("Your browser is unsupported");O=b,E=O.length-1,F=O[0].length-1,G=O[0][0].length-1,H=Math.floor(E/2),I=Math.floor(F/2),J=Math.floor(G/2),nb={x:H,y:I,z:J},$=x.max([E,G]),_=F+z+F+z+E+z+A+B,cb=x.scale.linear().range([0,1,2,3,4,5,6,7,8]).domain([0,F,F+z,2*F+z,2*F+2*z,2*F+2*z+E,2*F+3*z+E,2*F+3*z+E+A,_]),db=x.scale.linear().domain([0,E]).range([0,E]),eb=x.scale.linear().domain([0,F]).range([F,0]),fb=x.scale.linear().domain([0,F]).range([0,F]),gb=x.scale.linear().domain([0,G]).range([0,G]),hb=x.scale.linear().domain([0,255]).range([0,$]),y=x.select(ib).append("canvas").attr({width:_,height:$,"class":"datacube-slicer"}),p&&y.attr(p),D=y.node().getContext("2d"),y.call(m).call(g,O,0,0,F,$,J,2).call(g,O,F+z,0,F,$,H,0).call(g,O,2*F+2*z,0,E,$,I,1).call(n).call(l).on("mousemove",i).on("mouseout",j),A&&y.call(f,2*F+3*z+E,0),h(Q),C&&C()}function d(a){a||(a=Math.floor(cb.invert(7))),D.clearRect(a,0,B,$)}function e(a,b,c){return a>=b&&c>=a?a:Math.max(Math.min(a,c),b)}function f(a,b){var c=D.createLinearGradient(b,0,b,$);c.addColorStop(0,q[0]),c.addColorStop(1,"rgba("+t+","+u+","+v+",0)"),D.fillStyle=c,D.fillRect(b,0,A,$)}function g(a,b,c,d,e,f,g,h){var i;g=Math.floor(g);for(var j=[function(a,c){return b[g][F-1-c][a]},function(a,c){return b[c][g][a]},function(a,c){return b[a][F-1-c][g]}],k=[[G,F],[G,E],[G,F]],l=j[h],m=k[h][0],n=k[h][1],o=D.createImageData(e,f),p=0,q=-1;m>p;++p)for(var r=0;n>r;++r)i=l(p,r)||0,o.data[++q]=t,o.data[++q]=u,o.data[++q]=v,o.data[++q]=jb?0===i?0:255===i?0:T?255-i:i:T?255-i:i;D.putImageData(o,c,d)}function h(a){if(!a)return R&&clearInterval(R),R=null,S&&clearInterval(S),void(S=null);var b,c,d=x.min([E,F,G]);d===E?(b=H,c="x"):d===F?(b=I,c="y"):(b=J,c="z"),R=setInterval(function(){if(!S){var a=0;S=setInterval(function(){b/2>a?--nb[c]:1.5*b>a?++nb[c]:2*b>a?--nb[c]:(clearInterval(S),S=null),g(D,O,F+z,0,F,$,nb[c],0),g(D,O,2*F+2*z+z,0,E,$,nb[c],1),g(D,O,0,0,F,$,nb[c],2),++a},U)}},Math.floor(U*b*2*(1/P)))}function i(){var a=this,b=0,c=e(x.mouse(a)[0],0,_),d=e(x.mouse(a)[1],0,$);if(!K){if(L)return void++M;if(Y=cb(c),!(mb.indexOf(Math.floor(Y))<0)){switch(L=!0,h(!1),nb.x=Math.floor(nb.x),nb.y=Math.floor(nb.y),nb.z=Math.floor(nb.z),clearInterval(bb),clearTimeout(ab),ab=null,Math.ceil(cb(c))){case 1:nb.x=E-Math.floor(db.invert(d)),nb.y=Math.floor(eb.invert(c)),g(D,O,F+z,0,F,$,nb.x,0),g(D,O,2*F+2*z+z,0,E,$,nb.y,1);break;case 3:nb.z=Math.floor(gb.invert(d)),nb.y=F-Math.floor(fb.invert(c-F-z)),g(D,O,0,0,F,$,nb.z,2),g(D,O,2*F+2*z+z,0,E,$,nb.y,1);break;case 5:nb.z=Math.floor(gb.invert(d)),nb.x=Math.floor(db.invert(c-2*F-2*z)),g(D,O,0,0,F,$,nb.z,2),g(D,O,F+z,0,F,$,nb.x,0)}A&&o(),M&&(K=!0,b=e(M*Z,1,50),M=0),setTimeout(function(){L=!1,K=!1},b||0)}}}function j(){if(d(),1===V){if(U===a)throw new Error("Cannot animate MRI panes unless a max refresh rate is defined");var b=X,c=Math.ceil(b/U),e={x:(H-nb.x)/c,y:(I-nb.y)/c,z:(J-nb.z)/c};ab=setTimeout(function(){bb=setInterval(function(){nb.x+=e.x,nb.y+=e.y,nb.z+=e.z,g(D,O,F+z,0,F,$,nb.x,0),g(D,O,2*F+2*z+z,0,E,$,nb.y,1),g(D,O,0,0,F,$,nb.z,2),--c,c||(clearInterval(bb),nb.x=Math.floor(nb.x),nb.y=Math.floor(nb.y),nb.z=Math.floor(nb.z))},U)},W)}else k();h(Q)}function k(){nb.x=H,nb.y=I,nb.z=J,g(D,O,F+z,0,F,$,nb.x,0),g(D,O,2*F+2*z+z,0,E,$,nb.y,1),g(D,O,0,0,F,$,nb.z,2)}function l(){if(!kb||!lb)throw new Error("Timer flags must be set to compute max animation speed");U=Math.ceil(1.5*(lb-kb)),U>33&&(U=33),lb=kb=0}function m(){return kb=(new Date).getTime()}function n(){return lb=(new Date).getTime()}function o(){var b,c,e=Math.floor(cb.invert(7)),f=B-2,g=Math.PI/2,h=3*Math.PI/2;if(O[nb.x]!==a&&O[nb.x][nb.y]!==a&&O[nb.x][nb.y][nb.z]!==a)b=O[nb.x][nb.y][nb.z],c=Math.floor(hb(b));else{if(O[nb.x]===a)throw new Error("Heatmap has no X coord of "+nb.x);if(O[nb.x][nb.y]===a)throw new Error("Heatmap has no Y coord of "+nb.y);if(O[nb.x][nb.y][nb.z]===a)throw new Error("Heatmap has no Z coord of "+nb.z)}d(e),(!jb||0!==b&&255!==b)&&(D.strokeStyle=N,D.beginPath(),D.arc(e+1,c,f,g,h,!0),D.stroke(),D.beginPath(),D.moveTo(e+1,c),D.lineTo(e,c),D.stroke())}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb={x:null,y:null,z:null};if("undefined"!=typeof module&&"undefined"!=typeof require)x=require("d3"),r=require("color-string");else{if(!window.d3||!window.colorString)throw new Error("datacube slicer dependencies not met");x=window.d3,r=window.colorString}if("undefined"!=typeof module&&"undefined"!=typeof require)module.exports=b;else{if(window.datacubeSlicer)throw new Error("datacubeSlicerdy exists on the window.  Overwriting not permitted.");window.datacubeSlicer=b}}();
//# sourceMappingURL=datacube.img.slicer.min.js.map