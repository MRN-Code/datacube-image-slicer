!function(a){"use strict";function b(b){if(!b||!b.data)throw new Error("Attempted to build 3d slicer with insufficient config data!");if(b.mouseout===a||"slide-to-center"===b.mouseout)E=1;else{if("string"==typeof b.mouseout)throw new Error("Invalid mouseout requested");E=0}G=b.mouseoutAnimationDur||1e3,F=b.mouseoutDelay||500,b.idleAnimation&&(A=!0,z=b.idleAnimationPercentage||.25),R=b.target||"body",b.cb&&(q=b.cb),d3.json(b.data,c)}function c(a,b){if(a)throw console.error("Unable to fetch heatmap data"),a;if(!document.createElement("canvas").getContext)throw new Error("Your browser is unsupported");y=b,s=y.length,t=y[0].length,u=y[0][0].length,v=Math.floor(s/2),w=Math.floor(t/2),x=Math.floor(u/2),V={x:v,y:w,z:x},H=d3.max([s,u]),I=t+U+t+U+s+U+X+Y,L=d3.scale.linear().range([0,1,2,3,4,5,6,7,8]).domain([0,t,t+U,2*t+U,2*t+2*U,2*t+2*U+s,2*t+3*U+s,2*t+3*U+s+X,I]),M=d3.scale.linear().domain([0,s]).range([0,s]),N=d3.scale.linear().domain([0,t]).range([t,0]),O=d3.scale.linear().domain([0,t]).range([0,t]),P=d3.scale.linear().domain([0,u]).range([0,u]),Q=d3.scale.linear().domain([0,255]).range([0,H]),p=d3.select(R).append("canvas").attr({width:I,height:H,"class":"datacube-slicer"}),r=p.node().getContext("2d"),p.call(m).call(f,y,0,0,t,H,x,2).call(f,y,t+U,0,t,H,v,0).call(f,y,2*t+2*U,0,s,H,w,1).call(e,2*t+3*U+s,0).call(n).call(k).on("mousemove",h).on("mouseout",i),g(A),q&&q()}function d(a){a||(a=Math.floor(L.invert(7))),r.clearRect(a,0,Y,H)}function e(a,b){var c=r.createLinearGradient(b,0,b,H);c.addColorStop(0,"black"),c.addColorStop(1,"white"),r.fillStyle=c,r.fillRect(b,0,X,H)}function f(a,b,c,d,e,f,g,h){var i=0;g=Math.floor(g);for(var j=[function(a,c){return b[g][t-1-c][a]},function(a,c){return b[c][g][a]},function(a,c){return b[a][t-1-c][g]}],k=[[u,t],[u,s],[u,t]],m=j[h],n=k[h][0],o=k[h][1],p=r.createImageData(e,f),q=0,v=-1;n>q;++q)for(var w=0;o>w;++w)i=m(q,w),p.data[++v]=i,p.data[++v]=i,p.data[++v]=i,p.data[++v]=255*l(i%255);r.putImageData(p,c,d)}function g(a){if(!a)return B&&clearInterval(B),B=null,C&&clearInterval(C),void(C=null);var b,c,d=d3.min([s,t,u]);d===s?(b=v,c="x"):d===t?(b=w,c="y"):(b=x,c="z"),B=setInterval(function(){if(!C){var a=0;C=setInterval(function(){b/2>a?--V[c]:1.5*b>a?++V[c]:2*b>a?--V[c]:(clearInterval(C),C=null),f(r,y,t+U,0,t,H,V[c],0),f(r,y,2*t+2*U+U,0,s,H,V[c],1),f(r,y,0,0,t,H,V[c],2),++a},D)}},Math.floor(D*b*2*(1/z)))}function h(){if(1==W)return 0;var a=this,b=d3.mouse(a)[0],c=d3.mouse(a)[1];switch(g(!1),J&&(V.x=Math.floor(V.x),V.y=Math.floor(V.y),V.z=Math.floor(V.z),clearInterval(K),clearTimeout(J),J=null),Math.ceil(L(b))){case 1:V.x=s-Math.floor(M.invert(c)),V.y=Math.floor(N.invert(b)),f(r,y,t+U,0,t,H,V.x,0),f(r,y,2*t+2*U+U,0,s,H,V.y,1);break;case 3:V.z=Math.floor(P.invert(c)),V.y=t-Math.floor(O.invert(b-t-U)),f(r,y,0,0,t,H,V.z,2),f(r,y,2*t+2*U+U,0,s,H,V.y,1);break;case 5:V.z=Math.floor(P.invert(c)),V.x=Math.floor(M.invert(b-2*t-2*U)),f(r,y,0,0,t,H,V.z,2),f(r,y,t+U,0,t,H,V.x,0)}if(Math.floor(V.x)!=V.x)throw new Error("hey you should be an int");o()}function i(){if(1===E){if(D===a)throw new Error("Cannot animate MRI panes unless a max refresh rate is defined");var b=this,c=G,e=(d3.mouse(b)[0],d3.mouse(b)[1],Math.ceil(c/D)),h={x:(v-V.x)/e,y:(w-V.y)/e,z:(x-V.z)/e};J=setTimeout(function(){d(),K=setInterval(function(){V.x+=h.x,V.y+=h.y,V.z+=h.z,f(r,y,t+U,0,t,H,V.x,0),f(r,y,2*t+2*U+U,0,s,H,V.y,1),f(r,y,0,0,t,H,V.z,2),--e,e||(clearInterval(K),V.x=Math.floor(V.x),V.y=Math.floor(V.y),V.z=Math.floor(V.z))},D)},F)}else j();g(A)}function j(){V.x=v,V.y=w,V.z=x,f(r,y,t+U,0,t,H,V.x,0),f(r,y,2*t+2*U+U,0,s,H,V.y,1),f(r,y,0,0,t,H,V.z,2)}function k(){if(!S||!T)throw new Error("Timer flags must be set to compute max animation speed");D=Math.ceil(1.5*(T-S)),D>33&&(D=33),T=S=0}function l(a){return+a===a?0===a?a:a>0?1:-1:0/0}function m(){return S=(new Date).getTime()}function n(){return T=(new Date).getTime()}function o(){var b,c,e=Math.floor(L.invert(7)),f=Y-2,g=Math.PI/2,h=3*Math.PI/2;if(y[V.x]!==a&&y[V.x][V.y]!==a&&y[V.x][V.y][V.z]!==a)b=y[V.x][V.y][V.z],c=Math.floor(Q(b));else{if(y[V.x]===a)throw new Error("Heatmap has no X coord of "+V.x);if(y[V.x][V.y]===a)throw new Error("Heatmap has no Y coord of "+V.y);if(y[V.x][V.y][V.z]===a)throw new Error("Heatmap has no Z coord of "+V.z)}if(0>b||b>255)throw new Error("Invalid guageValue detected: "+b);d(e),b>0&&255>b&&(r.beginPath(),r.arc(e+1,c,f,g,h,!0),r.stroke(),r.beginPath(),r.moveTo(e+1,c),r.lineTo(e,c),r.stroke())}if("undefined"!=typeof module&&"undefined"!=typeof require)d3=require("d3");else{if(!window.d3)throw new Error("datacube slicer dependencies not met");d3=window.d3}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U=(d3.scale.linear().domain([0,255]).range(["black","white"]),5),V={x:null,y:null,z:null},W=0,X=20,Y=5;if("undefined"!=typeof module&&"undefined"!=typeof require)module.exports=b;else{if(window.datacubeSlicer)throw new Error("datacubeSlicerdy exists on the window.  Overwriting not permitted.");window.datacubeSlicer=b}}();
//# sourceMappingURL=datacube.img.slicer.min.js.map