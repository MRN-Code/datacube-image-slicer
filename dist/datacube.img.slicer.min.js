!function(a){"use strict";function b(a){var b;if(!a||!a.data)throw new Error("Attempted to build 3d slicer with insufficient config data!");q=["black","white"],L=!1,M=0,K=!1,z=5,A=0,N="#000000",B=5,P=.25,W=1e3,V=500,U=1,fb="body";for(var d in a)if(a.hasOwnProperty(d))switch(b=a[d],d){case"canvasAttrs":p=b;break;case"cb":C=b;break;case"data":break;case"debug":w=b;break;case"drawColor":q[0]=b;break;case"gap":z=b;break;case"gauge":A=a.gaugeWidth||20;break;case"gaugeWidth":A=b;break;case"gaugeDialColor":N=b;break;case"idleAnimation":Q=!0;break;case"idleAnimationPercentage":P=b;break;case"mouseout":if("slide-to-center"===b)break;U=0;break;case"mouseoutAnimationDur":W=b;break;case"mouseoutDelay":V=b;break;case"target":fb=b;break;default:throw new Error("Invalid configuration parameter passed ("+d+")")}s=r.getRgb(q[0]),t=s[0],u=s[1],v=s[2],x.json(a.data,c)}function c(a,b){if(a)throw console.error("Unable to fetch heatmap data"),a;if(!document.createElement("canvas").getContext)throw new Error("Your browser is unsupported");O=b,E=O.length-1,F=O[0].length-1,G=O[0][0].length-1,H=Math.floor(E/2),I=Math.floor(F/2),J=Math.floor(G/2),ib={x:H,y:I,z:J},X=x.max([E,G]),Y=F+z+F+z+E+z+A+B,_=x.scale.linear().range([0,1,2,3,4,5,6,7,8]).domain([0,F,F+z,2*F+z,2*F+2*z,2*F+2*z+E,2*F+3*z+E,2*F+3*z+E+A,Y]),ab=x.scale.linear().domain([0,E]).range([0,E]),bb=x.scale.linear().domain([0,F]).range([F,0]),cb=x.scale.linear().domain([0,F]).range([0,F]),db=x.scale.linear().domain([0,G]).range([0,G]),eb=x.scale.linear().domain([0,255]).range([0,X]),y=x.select(fb).append("canvas").attr({width:Y,height:X,"class":"datacube-slicer"}),p&&y.attr(p),D=y.node().getContext("2d"),y.call(m).call(g,O,0,0,F,X,J,2).call(g,O,F+z,0,F,X,H,0).call(g,O,2*F+2*z,0,E,X,I,1).call(n).call(l).on("mousemove",i).on("mouseout",j),A&&y.call(f,2*F+3*z+E,0),h(Q),C&&C()}function d(a){a||(a=Math.floor(_.invert(7))),D.clearRect(a,0,B,X)}function e(a,b,c){return a>=b&&c>=a?a:Math.max(Math.min(a,c),b)}function f(a,b){var c=D.createLinearGradient(b,0,b,X);c.addColorStop(0,q[0]),c.addColorStop(1,"rgba("+t+","+u+","+v+",0)"),D.fillStyle=c,D.fillRect(b,0,A,X)}function g(a,b,c,d,e,f,g,h){var i;g=Math.floor(g);for(var j=[function(a,c){return b[g][F-1-c][a]},function(a,c){return b[c][g][a]},function(a,c){return b[a][F-1-c][g]}],k=[[G,F],[G,E],[G,F]],l=j[h],m=k[h][0],n=k[h][1],o=D.createImageData(e,f),p=0,q=-1;m>p;++p)for(var r=0;n>r;++r)i=l(p,r)||0,o.data[++q]=t,o.data[++q]=u,o.data[++q]=v,o.data[++q]=255-i;D.putImageData(o,c,d)}function h(a){if(!a)return R&&clearInterval(R),R=null,S&&clearInterval(S),void(S=null);var b,c,d=x.min([E,F,G]);d===E?(b=H,c="x"):d===F?(b=I,c="y"):(b=J,c="z"),R=setInterval(function(){if(!S){var a=0;S=setInterval(function(){b/2>a?--ib[c]:1.5*b>a?++ib[c]:2*b>a?--ib[c]:(clearInterval(S),S=null),g(D,O,F+z,0,F,X,ib[c],0),g(D,O,2*F+2*z+z,0,E,X,ib[c],1),g(D,O,0,0,F,X,ib[c],2),++a},T)}},Math.floor(T*b*2*(1/P)))}function i(){if(!K){if(L)return void++M;L=!0;var a=this,b=0,c=e(x.mouse(a)[0],0,Y),d=e(x.mouse(a)[1],0,X);switch(h(!1),ib.x=Math.floor(ib.x),ib.y=Math.floor(ib.y),ib.z=Math.floor(ib.z),clearInterval($),clearTimeout(Z),Z=null,Math.ceil(_(c))){case 1:ib.x=E-Math.floor(ab.invert(d)),ib.y=Math.floor(bb.invert(c)),g(D,O,F+z,0,F,X,ib.x,0),g(D,O,2*F+2*z+z,0,E,X,ib.y,1);break;case 3:ib.z=Math.floor(db.invert(d)),ib.y=F-Math.floor(cb.invert(c-F-z)),g(D,O,0,0,F,X,ib.z,2),g(D,O,2*F+2*z+z,0,E,X,ib.y,1);break;case 5:ib.z=Math.floor(db.invert(d)),ib.x=Math.floor(ab.invert(c-2*F-2*z)),g(D,O,0,0,F,X,ib.z,2),g(D,O,F+z,0,F,X,ib.x,0)}A&&o(),M&&(K=!0,b=e(5*M,1,1e3),M=0),setTimeout(function(){L=!1,K=!1},b||0)}}function j(){if(d(),1===U){if(T===a)throw new Error("Cannot animate MRI panes unless a max refresh rate is defined");var b=W,c=Math.ceil(b/T),e={x:(H-ib.x)/c,y:(I-ib.y)/c,z:(J-ib.z)/c};Z=setTimeout(function(){$=setInterval(function(){ib.x+=e.x,ib.y+=e.y,ib.z+=e.z,g(D,O,F+z,0,F,X,ib.x,0),g(D,O,2*F+2*z+z,0,E,X,ib.y,1),g(D,O,0,0,F,X,ib.z,2),--c,c||(clearInterval($),ib.x=Math.floor(ib.x),ib.y=Math.floor(ib.y),ib.z=Math.floor(ib.z))},T)},V)}else k();h(Q)}function k(){ib.x=H,ib.y=I,ib.z=J,g(D,O,F+z,0,F,X,ib.x,0),g(D,O,2*F+2*z+z,0,E,X,ib.y,1),g(D,O,0,0,F,X,ib.z,2)}function l(){if(!gb||!hb)throw new Error("Timer flags must be set to compute max animation speed");T=Math.ceil(1.5*(hb-gb)),T>33&&(T=33),hb=gb=0}function m(){return gb=(new Date).getTime()}function n(){return hb=(new Date).getTime()}function o(){var b,c,e=Math.floor(_.invert(7)),f=B-2,g=Math.PI/2,h=3*Math.PI/2;if(O[ib.x]!==a&&O[ib.x][ib.y]!==a&&O[ib.x][ib.y][ib.z]!==a)b=O[ib.x][ib.y][ib.z],c=Math.floor(eb(b));else{if(O[ib.x]===a)throw new Error("Heatmap has no X coord of "+ib.x);if(O[ib.x][ib.y]===a)throw new Error("Heatmap has no Y coord of "+ib.y);if(O[ib.x][ib.y][ib.z]===a)throw new Error("Heatmap has no Z coord of "+ib.z)}if(0>b||b>255)throw new Error("Invalid guageValue detected: "+b);d(e),D.strokeStyle=N,console.log(N),D.beginPath(),D.arc(e+1,c,f,g,h,!0),D.stroke(),D.beginPath(),D.moveTo(e+1,c),D.lineTo(e,c),D.stroke()}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib={x:null,y:null,z:null};if("undefined"!=typeof module&&"undefined"!=typeof require)x=require("d3"),r=require("color-string");else{if(!window.d3||!window.colorString)throw new Error("datacube slicer dependencies not met");x=window.d3,r=window.colorString}if("undefined"!=typeof module&&"undefined"!=typeof require)module.exports=b;else{if(window.datacubeSlicer)throw new Error("datacubeSlicerdy exists on the window.  Overwriting not permitted.");window.datacubeSlicer=b}}();
//# sourceMappingURL=datacube.img.slicer.min.js.map